@using TripPlanner.Application.Common.Interfaces
@inherits LayoutComponentBase

@inject IUser CurrentUser
@inject IIdentityService IdentityService

<div class="antialiased text-white bg-slate-800 min-h-screen">
    @* <TopBar/> *@
    @* *@
    @* <SideBar/> *@

    <PageTitle>Trip Planner</PageTitle>

    <main class="grid place-items-center min-h-screen text-center">
        @if (_userId == null)
        {
            <WelcomeWizard/>
        }
        else
        {
            @Body
        }
    </main>
</div>

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">🗙</span>
</div>

@code {
    private string? _userId;

    protected override void OnInitialized()
    {
        // get user id
        _userId = CurrentUser.Id;

        // check if user exists
        if (_userId == null) return;

        if (!IdentityService.UserExists(_userId))
        {
            // remove token
            CurrentUser.ClearAccessKey();
        }
    }

}